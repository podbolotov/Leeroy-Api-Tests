## Leeroy Library Catalog Emulator (LLCE)

![LLCE-T Banner](docs/images/llce-t_banner.png "LLCE-T banner")
## Что это?
Данный репозиторий содержит автоматические тесты API и БД приложения [Leeroy Library Catalog Emulator (LLCE)](https://github.com/podbolotov/Leeroy).

> [!WARNING]
> Как приложение, так и тесты к нему находятся в ранней стадии разработки и могут меняться непредсказуемым образом.
> Используйте их только в случае, если точно понимаете, что делаете. 

## Как это работает?

### Введение
Данные тесты представляют собой фреймворк, обособленный от кодовой базы LLCE.\
Тестирование осуществляется посредством взаимодействия с REST API приложения и сверки полученных/записанных данных с данными в БД приложения. 

В качестве основных инструментов фреймворка применяются:
- **Pytest** - для управления процессом тестирования и объявления тестовых классов, функций, фикстур.
- **Pydantic** - для верификации HTTP-ответов и данных из БД.
- **psycopg2** - для взаимодействия с базой данных приложения. 
- **allure2** - для генерации отчёта о тестировании.

### Modus operandi

Тесты работают в один поток, последовательно и синхронно.\
Ввиду небольшой сложности тестируемого проекта (и, как следствие, небольшого времени на последовательное исполнение тестов) разработка асинхронных тестов для параллельного исполнения была сочтена нецелесообразной. 

Тесты пишутся с оглядкой на принцип изоляции: тесты на любой функциональный домен, или же любой отдельный тестовый набор или одиночный тест, могут быть запущены изолированно от остальных тестов.\
Тесты не ссылаются друг на друга и не зависят от порядка исполнения.

Тесты размещены в директории `tests` и сгруппированы во вложенные директории, в зависимости от того, к какому функциональному домену приложения они относятся. 

Для реализации стадий подготовки к тесту и уборки после теста используются pytest-фикстуры.\
Для реализации комплексных предусловий и пост-условий используются цепочки ссылающихся друг на друга фикстур. 

Фикстуры разнесены по conftest-файлам разного уровня: общие для всех функциональных доменов фикстуры находятся в корневом conftest, фикстуры предназначенные только для конкретного функционального домена - в находятся в conftest-файле на одном уровне с тестовыми наборами этого функционального домена. 

В ряде тестов используется параметризация тестов и indirect-параметризация фикстур (для параметризации предусловий). 

### Запуск и конфигурирование тестов

Тестовый фреймворк конфигурируется посредством перемененных окружения.\
Класс **FrameworkVariables**, извлекающий переменные окружения из оболочки, находится в файле [data/framework_variables.py](data/framework_variables.py).
В случае, если данные запущенного инстанса тестируемого приложения отличаются от данных по умолчанию, приведённых в классе FrameworkVariables, то передайте при запуске тестов корректные значения тех переменных, которые необходимо переопределить. 

Для запуска тестов можно воспользоваться одним из предложенных отладочных скриптов (`run.sh` или `run.ps1`), либо же вызвать pytest напрямую из оболочки. 

Перед запуском тестов убедитесь, что все перечисленные в `requirements.txt` зависимости установлены в виртуальное окружение, а в переменную PATH вашей системы внесена директория, содержащая бинарные файлы Allure2, используемого для генерации отчёта. 

## Дополнительная информация

Пример отчёта, генерируемого после прохождения тестов, можно загрузить из данного репозитория по [следующей ссылке](https://raw.githubusercontent.com/Podbolotov/Leeroy-Api-Tests/main/docs/files/example_report.html) (используйте "сохранить как").

----
### Копирайт

Автор иконки, используемой на баннере: [juicy_fish (flaticon.com)](https://www.flaticon.com/free-icon/testing_6403868).

Используемый на баннере шрифт: [JetBrains Mono](https://www.jetbrains.com/lp/mono/).

### Отказ от ответственности

Автор не несёт ответственности за любой ущерб (будь то потеря денежных средств, данных, здоровья или душевного спокойствия), который может нанести данный комплект тестов. 

Используя данный комплект тестов (для ознакомления, в качестве примера, в иных целях) Вы согласны с тем, что он предоставляется "как есть", однако вы всегда можете выразить благодарность/негодование связавшись с автором через электронную почту или открыв issue. 